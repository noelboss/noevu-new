---
import type { ValuePropositionSection, Theme } from '../../schemas/sections';
import { parseInlineMarkdown } from '../../utils/markdown';

interface Props {
  data: ValuePropositionSection;
  theme?: Theme;
}

const { data, theme } = Astro.props;
const { title, subtitle, items } = data;
const parsedTitle = parseInlineMarkdown(title);
const parsedSubtitle = parseInlineMarkdown(subtitle);
---

<section class="value-prop section" data-theme={theme}>
  <div class="container">
    {(parsedTitle || parsedSubtitle) && (
      <header class="value-prop__header">
        {parsedTitle && <h2 class="value-prop__title" set:html={parsedTitle} />}
        {parsedSubtitle && <p class="value-prop__subtitle" set:html={parsedSubtitle} />}
      </header>
    )}
    <div class="value-prop__grid">
      {items.map((item) => (
        <article class="value-prop__card">
          {item.image && (
            <div class="value-prop__image-wrapper">
              <img
                src={item.image.src}
                alt={item.image.alt}
                width={item.image.width}
                height={item.image.height}
                class="value-prop__image"
                loading="lazy"
              />
            </div>
          )}
          {item.icon && !item.image && (
            <div class="value-prop__icon" aria-hidden="true">
              <Fragment set:html={item.icon} />
            </div>
          )}
          <div class="value-prop__content">
            <h3 class="value-prop__card-title">
              <span class="value-prop__dot" aria-hidden="true"></span>
              <span set:html={parseInlineMarkdown(item.title)} />
            </h3>
            <div class="value-prop__description" set:html={parseInlineMarkdown(item.description)} />
          </div>
        </article>
      ))}
    </div>
  </div>
</section>

<style>
  /* Section base */
  .value-prop {
    background-color: var(--theme-bg, var(--color-bg-beige));
    color: var(--theme-text, var(--color-text));
  }

  /* Header with title and subtitle */
  .value-prop__header {
    text-align: center;
    max-width: 800px;
    margin-inline: auto;
    margin-bottom: var(--space-16);
  }

  .value-prop__title {
    font-family: var(--font-heading);
    font-size: var(--text-4xl);
    font-weight: var(--font-normal);
    line-height: var(--leading-tight);
    color: var(--theme-heading, var(--color-text));
    margin-bottom: var(--space-4);
  }

  .value-prop__subtitle {
    font-family: var(--font-sans);
    font-size: var(--text-lg);
    color: var(--theme-text-muted, var(--color-text-muted));
    line-height: var(--leading-relaxed);
    max-width: 700px;
    margin-inline: auto;
  }

  /* Responsive grid */
  .value-prop__grid {
    display: grid;
    gap: var(--space-8);
    grid-template-columns: 1fr;
  }

  @media (min-width: 640px) {
    .value-prop__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .value-prop__grid {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-10);
    }
  }

  /* Card styling with glass effect and 3D transforms */
  .value-prop__card {
    position: relative;
    display: flex;
    flex-direction: column;
    background: hsla(var(--color-white-hsl), 0.7);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: var(--radius-xl);
    overflow: hidden;
    /* 3D perspective setup */
    transform-style: preserve-3d;
    /* 3-layer shadow matching original */
    box-shadow:
      0px 0px 15px hsla(17, 100%, 59%, 0.15),
      8px 8px 40px hsla(0, 0%, 100%, 0.3),
      inset -5px -5px 10px hsla(17, 100%, 59%, 0.08);
    transition:
      transform 0.3s ease-out,
      box-shadow 0.3s ease-out,
      filter 0.3s ease-out;
  }

  .value-prop__card:hover {
    /* 3D rotation effect */
    transform: perspective(1000px) rotateX(2deg) rotateY(-3deg) translateZ(10px);
    filter: brightness(1.05) saturate(1.1);
    box-shadow:
      0px 0px 20px hsla(17, 100%, 59%, 0.25),
      12px 12px 50px hsla(0, 0%, 100%, 0.4),
      inset -5px -5px 10px hsla(17, 100%, 59%, 0.12);
  }

  /* Image wrapper with gradient background */
  .value-prop__image-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 4 / 3;
    background: linear-gradient(
      135deg,
      hsla(var(--color-beige-hsl), 1) 0%,
      hsla(var(--color-orange-hsl), 0.15) 100%
    );
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-6);
    overflow: hidden;
  }

  .value-prop__image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform var(--transition-slow);
  }

  .value-prop__card:hover .value-prop__image {
    transform: scale(1.08) rotate(-1deg);
    filter: brightness(1.08);
  }

  /* Icon fallback (when no image) with glass effect */
  .value-prop__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 4rem;
    height: 4rem;
    margin: var(--space-8) auto var(--space-4);
    background: linear-gradient(
      135deg,
      hsla(var(--color-beige-hsl), 1) 0%,
      hsla(var(--color-orange-hsl), 0.2) 100%
    );
    border-radius: var(--radius-lg);
    color: var(--color-orange);
    /* Glass effect */
    backdrop-filter: blur(10px);
    border: 1px solid hsla(255, 255, 255, 0.15);
    box-shadow:
      inset 5px 0 20px 0 hsla(17, 100%, 59%, 0.1),
      inset 0 -10px 20px 0 hsla(17, 100%, 59%, 0.05);
  }

  .value-prop__icon :global(svg) {
    width: 2rem;
    height: 2rem;
  }

  /* Card content area */
  .value-prop__content {
    padding: var(--space-6) var(--space-6) var(--space-8);
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  /* Card title with orange dot */
  .value-prop__card-title {
    position: relative;
    font-family: var(--font-heading);
    font-size: var(--text-xl);
    font-weight: var(--font-normal);
    line-height: var(--leading-snug);
    color: var(--theme-heading, var(--color-text));
    margin-bottom: var(--space-4);
    padding-left: var(--space-5);
  }

  .value-prop__dot {
    position: absolute;
    left: 0;
    top: 0.5em;
    width: 6px;
    height: 6px;
    background-color: var(--color-orange, #ff6b30);
    border-radius: 50%;
    box-shadow: 0 0 5px hsla(var(--color-orange-hsl, 17, 100%, 59%), 0.75);
  }

  /* Description text */
  .value-prop__description {
    font-family: var(--font-sans);
    font-size: var(--text-base);
    color: var(--theme-text-muted, var(--color-text-muted));
    line-height: var(--leading-relaxed);
  }

  .value-prop__description :global(p) {
    margin-bottom: var(--space-3);
  }

  .value-prop__description :global(p:last-child) {
    margin-bottom: 0;
  }

  .value-prop__description :global(strong) {
    color: var(--color-orange);
    font-weight: var(--font-medium);
  }

  /* Responsive adjustments */
  @media (max-width: 639px) {
    .value-prop__header {
      margin-bottom: var(--space-10);
    }

    .value-prop__title {
      font-size: var(--text-3xl);
    }

    .value-prop__subtitle {
      font-size: var(--text-base);
    }

    .value-prop__card-title {
      font-size: var(--text-lg);
    }

    .value-prop__description {
      font-size: var(--text-sm);
    }
  }

  /* Dark theme adjustments */
  [data-theme="dark"] .value-prop__card,
  [data-theme="dark-bold"] .value-prop__card,
  [data-theme="black"] .value-prop__card,
  [data-theme="black-bold"] .value-prop__card {
    background: hsla(var(--color-white-hsl), 0.08);
    border: 1px solid hsla(var(--color-white-hsl), 0.1);
  }

  [data-theme="dark"] .value-prop__card:hover,
  [data-theme="dark-bold"] .value-prop__card:hover,
  [data-theme="black"] .value-prop__card:hover,
  [data-theme="black-bold"] .value-prop__card:hover {
    box-shadow:
      0 12px 40px -8px hsla(var(--color-black-hsl), 0.4),
      0 0 30px -5px hsla(var(--color-orange-hsl), 0.15);
  }

  [data-theme="dark"] .value-prop__image-wrapper,
  [data-theme="dark-bold"] .value-prop__image-wrapper,
  [data-theme="black"] .value-prop__image-wrapper,
  [data-theme="black-bold"] .value-prop__image-wrapper {
    background: linear-gradient(
      135deg,
      hsla(var(--color-grey-hsl), 0.3) 0%,
      hsla(var(--color-orange-hsl), 0.15) 100%
    );
  }

  [data-theme="dark"] .value-prop__icon,
  [data-theme="dark-bold"] .value-prop__icon,
  [data-theme="black"] .value-prop__icon,
  [data-theme="black-bold"] .value-prop__icon {
    background: linear-gradient(
      135deg,
      hsla(var(--color-grey-hsl), 0.3) 0%,
      hsla(var(--color-orange-hsl), 0.2) 100%
    );
  }
</style>
