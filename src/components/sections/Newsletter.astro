---
/**
 * Newsletter Signup Section
 *
 * Email signup form for blog/marketing pages.
 * Uses simple form that can be connected to email service.
 */
import type { NewsletterSection, Theme } from '../../schemas/sections';
import { parseInlineMarkdown } from '../../utils/markdown';

interface Props {
  data: NewsletterSection;
  theme?: Theme;
}

const { data, theme } = Astro.props;
const {
  title = 'Insights für euren digitalen Vorsprung',
  description = 'Erhaltet regelmässig Tipps, News und Strategien rund um Webdesign, AI und digitales Marketing – direkt in euren Posteingang.',
  buttonText = 'Jetzt anmelden',
  placeholderText = 'Eure E-Mail-Adresse',
  privacyText = 'Wir respektieren eure Privatsphäre. Abmeldung jederzeit möglich.',
  backgroundColor = 'green',
} = data;

// Use theme system when available, fall back to backgroundColor classes for backward compatibility
const bgClass = theme ? '' : `newsletter--${backgroundColor}`;
---

<section class={`newsletter section ${bgClass}`} data-theme={theme}>
  <div class="newsletter__container container">
    <div class="newsletter__content">
      <h2 class="newsletter__title" set:html={parseInlineMarkdown(title)} />
      {description && <p class="newsletter__description" set:html={parseInlineMarkdown(description)} />}

      <form class="newsletter__form" action="/api/newsletter" method="POST" data-newsletter-form>
        <div class="newsletter__input-group">
          <input
            type="email"
            name="email"
            placeholder={placeholderText}
            required
            class="newsletter__input"
            aria-label="E-Mail-Adresse"
          />
          <button type="submit" class="newsletter__button">
            <span class="newsletter__button-text">{buttonText}</span>
            <span class="newsletter__button-icon">
              <span class="material-symbols-outlined">mail</span>
            </span>
          </button>
        </div>
        <p class="newsletter__privacy">{privacyText}</p>
      </form>
    </div>
  </div>
</section>

<style>
  /* ═══════════════════════════════════════════════════════════════
     BASE STYLES
     ═══════════════════════════════════════════════════════════════ */
  .newsletter {
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  /* ═══════════════════════════════════════════════════════════════
     THEME SYSTEM STYLES
     ═══════════════════════════════════════════════════════════════ */
  .newsletter[data-theme] {
    background-color: var(--theme-bg);
    color: var(--theme-text);
  }

  .newsletter[data-theme] .newsletter__title {
    color: var(--theme-heading);
  }

  .newsletter[data-theme] .newsletter__input {
    background-color: var(--theme-input-bg, rgba(255, 255, 255, 0.15));
    color: var(--theme-text);
    border-color: var(--theme-input-border, transparent);
  }

  .newsletter[data-theme] .newsletter__input::placeholder {
    color: var(--theme-text-muted, rgba(255, 255, 255, 0.7));
  }

  .newsletter[data-theme] .newsletter__input:focus {
    border-color: var(--theme-input-focus, var(--theme-accent));
    background-color: var(--theme-input-bg-focus, rgba(255, 255, 255, 0.25));
  }

  /* ═══════════════════════════════════════════════════════════════
     BACKGROUND COLOR VARIANTS
     ═══════════════════════════════════════════════════════════════ */
  .newsletter--green {
    background-color: var(--color-primary);
    color: var(--color-text-inverted);
  }

  .newsletter--beige {
    background-color: var(--color-bg-beige);
    color: var(--color-text);
  }

  .newsletter--orange {
    background-color: var(--color-accent);
    color: var(--color-text-inverted);
  }

  .newsletter--white {
    background-color: var(--color-bg-white);
    color: var(--color-text);
  }

  /* ═══════════════════════════════════════════════════════════════
     CONTENT CONTAINER - Glass card effect
     ═══════════════════════════════════════════════════════════════ */
  .newsletter__content {
    max-width: 640px;
    margin-inline: auto;
    padding: var(--space-8);
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.1) 0%,
      rgba(255, 255, 255, 0.05) 100%
    );
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-xl);
    box-shadow:
      0 0 20px rgba(255, 255, 255, 0.1),
      0 8px 32px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  .newsletter__content:hover {
    box-shadow:
      0 0 30px rgba(255, 255, 255, 0.15),
      0 12px 40px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
  }

  /* Light background variants - different glass effect */
  .newsletter--beige .newsletter__content,
  .newsletter--white .newsletter__content {
    background: linear-gradient(
      135deg,
      rgba(37, 90, 78, 0.05) 0%,
      rgba(37, 90, 78, 0.02) 100%
    );
    border-color: rgba(37, 90, 78, 0.1);
    box-shadow:
      0 0 20px rgba(37, 90, 78, 0.05),
      0 8px 32px rgba(0, 0, 0, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
  }

  .newsletter--beige .newsletter__content:hover,
  .newsletter--white .newsletter__content:hover {
    box-shadow:
      0 0 30px rgba(37, 90, 78, 0.1),
      0 12px 40px rgba(0, 0, 0, 0.12),
      inset 0 1px 0 rgba(255, 255, 255, 0.6);
  }

  /* ═══════════════════════════════════════════════════════════════
     TITLE
     ═══════════════════════════════════════════════════════════════ */
  .newsletter__title {
    font-size: clamp(1.75rem, 4vw, var(--text-4xl));
    font-family: var(--font-display);
    font-weight: var(--font-normal);
    line-height: var(--leading-tight);
    margin-bottom: var(--space-4);
  }

  .newsletter--green .newsletter__title,
  .newsletter--orange .newsletter__title {
    color: var(--color-text-inverted);
  }

  .newsletter--beige .newsletter__title,
  .newsletter--white .newsletter__title {
    color: var(--color-text);
  }

  /* ═══════════════════════════════════════════════════════════════
     DESCRIPTION
     ═══════════════════════════════════════════════════════════════ */
  .newsletter__description {
    font-size: var(--text-base);
    margin-bottom: var(--space-8);
    line-height: var(--leading-relaxed);
    max-width: 520px;
    margin-inline: auto;
  }

  .newsletter--green .newsletter__description,
  .newsletter--orange .newsletter__description {
    opacity: 0.9;
  }

  .newsletter--beige .newsletter__description,
  .newsletter--white .newsletter__description {
    color: var(--color-text-muted);
  }

  /* ═══════════════════════════════════════════════════════════════
     FORM
     ═══════════════════════════════════════════════════════════════ */
  .newsletter__form {
    max-width: 520px;
    margin-inline: auto;
  }

  /* ═══════════════════════════════════════════════════════════════
     INPUT GROUP (Input + Button Row)
     ═══════════════════════════════════════════════════════════════ */
  .newsletter__input-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    margin-bottom: var(--space-4);
  }

  @media (min-width: 540px) {
    .newsletter__input-group {
      flex-direction: row;
      align-items: stretch;
      gap: var(--space-4);
    }
  }

  /* ═══════════════════════════════════════════════════════════════
     INPUT FIELD - Glass morphism style
     ═══════════════════════════════════════════════════════════════ */
  .newsletter__input {
    flex: 1;
    padding: 0.875rem 1.25rem;
    font-size: var(--text-base);
    font-family: var(--font-sans);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: var(--radius-full);
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.2) 0%,
      rgba(255, 255, 255, 0.1) 100%
    );
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: var(--color-text-inverted);
    box-shadow:
      0 0 10px rgba(255, 255, 255, 0.05),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  /* Dark background variants (green, orange) */
  .newsletter--green .newsletter__input,
  .newsletter--orange .newsletter__input {
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.2) 0%,
      rgba(255, 255, 255, 0.1) 100%
    );
    color: var(--color-text-inverted);
    border-color: rgba(255, 255, 255, 0.25);
  }

  .newsletter--green .newsletter__input::placeholder,
  .newsletter--orange .newsletter__input::placeholder {
    color: rgba(255, 255, 255, 0.7);
  }

  .newsletter--green .newsletter__input:focus,
  .newsletter--orange .newsletter__input:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.5);
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.3) 0%,
      rgba(255, 255, 255, 0.15) 100%
    );
    box-shadow:
      0 0 20px rgba(255, 255, 255, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  /* Light background variants (beige, white) */
  .newsletter--beige .newsletter__input,
  .newsletter--white .newsletter__input {
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.9) 0%,
      rgba(255, 255, 255, 0.7) 100%
    );
    color: var(--color-text);
    border-color: rgba(37, 90, 78, 0.15);
    box-shadow:
      0 0 10px rgba(37, 90, 78, 0.05),
      inset 0 1px 0 rgba(255, 255, 255, 0.8);
  }

  .newsletter--beige .newsletter__input::placeholder,
  .newsletter--white .newsletter__input::placeholder {
    color: var(--color-text-muted);
  }

  .newsletter--beige .newsletter__input:focus,
  .newsletter--white .newsletter__input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow:
      0 0 20px rgba(37, 90, 78, 0.15),
      inset 0 1px 0 rgba(255, 255, 255, 0.9);
  }

  /* ═══════════════════════════════════════════════════════════════
     SUBSCRIBE BUTTON (Orange with Icon Pill - Hero CTA Style)
     3-layer shadow: outer glow, spread glow, inset highlight
     ═══════════════════════════════════════════════════════════════ */
  .newsletter__button {
    display: inline-flex;
    align-items: center;
    position: relative;
    background-color: var(--color-orange, #ff6b30);
    color: white;
    padding: 0.875rem 1.5rem;
    padding-right: 3.5rem;
    border-radius: var(--radius-full);
    font-family: var(--font-sans);
    font-weight: 500;
    font-size: 0.9375rem;
    text-decoration: none;
    border: 1px solid rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow:
      0 0 15px hsla(17, 100%, 59%, 0.3),
      8px 8px 40px hsla(17, 100%, 59%, 0.5),
      inset -5px -5px 10px rgba(255, 255, 255, 0.15);
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    flex-shrink: 0;
    overflow: hidden;
  }

  .newsletter__button:hover {
    box-shadow:
      0 0 20px hsla(17, 100%, 59%, 0.5),
      12px 12px 50px hsla(17, 100%, 59%, 0.6),
      inset -5px -5px 10px hsla(17, 100%, 80%, 0.2);
    transform: translateY(-2px);
    filter: brightness(1.05);
  }

  .newsletter__button:active {
    transform: translateY(0);
    filter: brightness(0.98);
  }

  .newsletter__button-text {
    color: white;
  }

  .newsletter__button-icon {
    position: absolute;
    right: 4px;
    top: 4px;
    bottom: 4px;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 50%;
    color: var(--color-orange, #ff6b30);
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .newsletter__button-icon .material-symbols-outlined {
    font-size: 1.125rem;
  }

  .newsletter__button:hover .newsletter__button-icon {
    width: calc(100% - 8px);
    border-radius: var(--radius-full);
  }

  /* Button variant for orange background */
  .newsletter--orange .newsletter__button {
    background-color: var(--color-primary);
    box-shadow:
      0 0 15px hsla(163, 41%, 25%, 0.3),
      8px 8px 40px hsla(163, 41%, 25%, 0.5),
      inset -5px -5px 10px rgba(255, 255, 255, 0.15);
  }

  .newsletter--orange .newsletter__button:hover {
    box-shadow:
      0 0 20px hsla(163, 41%, 25%, 0.5),
      12px 12px 50px hsla(163, 41%, 25%, 0.6),
      inset -5px -5px 10px hsla(163, 60%, 40%, 0.2);
  }

  .newsletter--orange .newsletter__button-icon {
    color: var(--color-primary);
  }

  /* Button variant for light backgrounds */
  .newsletter--beige .newsletter__button,
  .newsletter--white .newsletter__button {
    box-shadow:
      0 0 15px hsla(17, 100%, 59%, 0.25),
      8px 8px 40px hsla(17, 100%, 59%, 0.3),
      inset -5px -5px 10px rgba(255, 255, 255, 0.15);
  }

  .newsletter--beige .newsletter__button:hover,
  .newsletter--white .newsletter__button:hover {
    box-shadow:
      0 0 20px hsla(17, 100%, 59%, 0.4),
      12px 12px 50px hsla(17, 100%, 59%, 0.5),
      inset -5px -5px 10px hsla(17, 100%, 80%, 0.2);
  }

  /* ═══════════════════════════════════════════════════════════════
     PRIVACY TEXT
     ═══════════════════════════════════════════════════════════════ */
  .newsletter__privacy {
    font-size: var(--text-sm);
    margin: 0;
  }

  .newsletter--green .newsletter__privacy,
  .newsletter--orange .newsletter__privacy {
    opacity: 0.7;
  }

  .newsletter--beige .newsletter__privacy,
  .newsletter--white .newsletter__privacy {
    color: var(--color-text-muted);
  }

  /* ═══════════════════════════════════════════════════════════════
     DARK THEME SUPPORT
     ═══════════════════════════════════════════════════════════════ */
  @media (prefers-color-scheme: dark) {
    .newsletter--beige,
    .newsletter--white {
      background-color: var(--color-neutral-900);
      color: var(--color-text-inverted);
    }

    .newsletter--beige .newsletter__title,
    .newsletter--white .newsletter__title {
      color: var(--color-text-inverted);
    }

    .newsletter--beige .newsletter__description,
    .newsletter--white .newsletter__description {
      color: rgba(255, 255, 255, 0.8);
    }

    .newsletter--beige .newsletter__content,
    .newsletter--white .newsletter__content {
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.08) 0%,
        rgba(255, 255, 255, 0.03) 100%
      );
      border-color: rgba(255, 255, 255, 0.1);
    }

    .newsletter--beige .newsletter__input,
    .newsletter--white .newsletter__input {
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.15) 0%,
        rgba(255, 255, 255, 0.08) 100%
      );
      color: var(--color-text-inverted);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .newsletter--beige .newsletter__input::placeholder,
    .newsletter--white .newsletter__input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .newsletter--beige .newsletter__privacy,
    .newsletter--white .newsletter__privacy {
      color: rgba(255, 255, 255, 0.6);
    }
  }

  /* ═══════════════════════════════════════════════════════════════
     RESPONSIVE ADJUSTMENTS
     ═══════════════════════════════════════════════════════════════ */
  @media (max-width: 539px) {
    .newsletter__content {
      padding: var(--space-6);
    }

    .newsletter__button {
      width: 100%;
      justify-content: center;
      padding-right: 3.5rem;
    }
  }
</style>

<script>
  // Simple client-side form handling
  document.addEventListener('DOMContentLoaded', () => {
    const forms = document.querySelectorAll('[data-newsletter-form]');

    forms.forEach(form => {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form as HTMLFormElement);
        const email = formData.get('email');

        // For now, show a success message (actual integration would go here)
        const button = form.querySelector('.newsletter__button') as HTMLButtonElement;
        const originalText = button.textContent;
        button.textContent = 'Danke!';
        button.disabled = true;

        // In production, you would send this to your email service
        console.log('Newsletter signup:', email);

        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
          (form as HTMLFormElement).reset();
        }, 3000);
      });
    });
  });
</script>
